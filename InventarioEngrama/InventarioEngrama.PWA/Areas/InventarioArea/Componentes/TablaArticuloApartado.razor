@using InventarioEngrama.Share.Objetos.Inventario
@inherits EngramaComponent

@if (ArticulosApartados.Any())
{
	<MudTable Items="@ArticulosApartados"
			  T="@ArticulosApartados"
			  Dense="@true"
			  Hover="true"
			  Filter="new Func<ArticulosApartados,bool>(FilterFunc1)">
		<ToolBarContent>
			<MudText Typo="Typo.h6">Tabla de Artículos Apartados</MudText>
			<MudSpacer />
			<MudTextField @bind-Value="searchStringFiltro"
						  Placeholder="Buscar"
						  Adornment="Adornment.Start"
						  AdornmentIcon="@Icons.Material.Filled.Search"
						  IconSize="Size.Medium"
						  Class="mt-0">
			</MudTextField>
		</ToolBarContent>
		<HeaderContent>
			<MudTh>Nombre</MudTh>
			<MudTh>Descripción</MudTh>
			<MudTh>Cantidad</MudTh>
			<MudTh>Precio Final</MudTh>
			@if (ShowDelete)
			{
				<MudTh></MudTh>
			}
		</HeaderContent>
		<RowTemplate>

			<MudTd DataLabel="Nombre">@context.Articulo.nvchNombre</MudTd>
			<MudTd DataLabel="Descripción">@context.Articulo.nvchDescripcion</MudTd>
			<MudTd DataLabel="Cantidad">@context.iCantidad</MudTd>
			<MudTd DataLabel="Precio Final">@context.mPrecioFinal.ToString("C2")</MudTd>
			@if (ShowDelete)
			{
				<MudTd DataLabel="">
					<MudFab Color="Color.Error" StartIcon="@Icons.Material.Filled.Delete" OnClick="@(()=>OnClickDelete(context))" />
				</MudTd>
			}
		</RowTemplate>
		<PagerContent>
			<MudTablePager />
		</PagerContent>
	</MudTable>
}
@code {
	[Parameter] public IList<ArticulosApartados> ArticulosApartados { get; set; }

	[Parameter] public EventCallback<ArticulosApartados> EC_EliminarArticuloApartado { get; set; }
	[Parameter] public bool ShowDelete { get; set; }


	private async Task OnClickDelete(ArticulosApartados articulosApartados)
	{
		await EC_EliminarArticuloApartado.InvokeAsync(articulosApartados);
	}

	private string searchStringFiltro = "";
	private bool FilterFunc1(ArticulosApartados element) => FilterFunc(element, searchStringFiltro);
	private bool FilterFunc(ArticulosApartados element, string searchString)
	{
		if (string.IsNullOrWhiteSpace(searchString))
			return true;
		if (element.Articulo.nvchNombre.Contains(searchString, StringComparison.OrdinalIgnoreCase)) // Agrega el campo por el caul realizar el filtro
			return true;
		return false;
	}
}
